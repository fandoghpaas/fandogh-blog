# Zero Downtime Deployment

در این پست به تشریح فرایند استقرار نسخه‌های جدید یک سرویس بر روی فندق می‌پردازیم. این مطالب به شما کمک خواهد کرد تا با مفهوم Zero downtime Deployment بیشتر آشنا شوید. همچنین برای اینکه فندق بتواند این نوع استقرار را به درستی انجام  دهد تنظیماتی از جانب کاربران مورد نیاز است که در این پست به تشریح آنها نیز خواهیم پرداخت.

##  چرا Zero Downtime Deployment?

یکی از مشکلاتی که در حین استقرار سرویس‌ها و وب‌ سایت‌ها ممکن است اتفاق بیفتد در دسترس نبودن سرویس برای مدتی نامعلوم است که می‌تواند منجر به از دست مشتری‌ها و یا نارضایتی آنها شود.

تفاوتی ندارد که شما به صورت انفرادی در حال توسعه محصولی کوچک هستید و یا در تیمی بزرگ بر روی محصولی سازمانی کار می‌کنید. همیشه بخشی از زمان شما و یا تیم شما برای استقرار و نگهداری سرویس‌هایتان خرج می‌شود.
 
اگر این کار را به صورت دستی انجام شود بخش قابل ملاحظه‌ای از زمان خود را به خود اختصاص می‌دهد و همینطور در هر یک از مراحل استقرار امکان اشتباه انسانی وجود دارد که ممکن است منجر به قطع شدن سرویس شما برای مدتی بیش از حد پیش بینی شما شود. 


## فندق و Zero Downtime Deployment

در فندق تمام مراحل استقرار نسخه جدید سرویس به صورت خودکار صورت می‌گیرد و کاربر تنها نیاز به مانیتور استقرار دارد تا  مطمئن شود  که نسخه جدید بدون مشکل مستقر شده است.

::: warning     
 حتی در صورت وجود مشکل در نسخه جدید سرویس شما از دسترس خارج نخواهد شد و نسخه قبلی سرویس شما به کاربران سرویس خواهد داد. 
:::

برای اینکه فندق بتواند به صورت خودکار و بدون down time استقرار نسخه جدید را انجام دهد نیاز به روشی برای تست سلامت سرویس شما خواهد داشت (healthcheck). با استفاده از این تست فندق قبل از خارج کردن نسخه قبلی سرویس شما می‌تواند مطمئن شود که نسخه جدید به درستی و بدون مشکل مستقر شده و آماده دسترسی به درخواست کاربران و یا دیگر سرویس‌ها است. 

در ادامه به صورت قدم به قدم به همراه مثال مراحل لازم برای ایجاد یک سرویس با قابلیت تست سلامت و نحوه عملکرد فندق را شرح خواهیم داد.


کدهای استفاده شده در این پست را می‌توانید از
[‌اینجا](
https://github.com/fandoghpaas/fandogh-examples/tree/master/zero-downtime
)
مشاهده و دانلود کنید.


## مطالعه موردی

در این مثال فرض بر این است که نسخه اول یک وب اپلیکیشن که دارای دو replica است در حال حاضر روی فندق مستقر شده است و ما قصد داریم نسخه ۱.۱ این وب اپلیکیشن را بدون از دسترس خارج شدن بر روی فندق مستقر کنیم. 

کد مربوط به نسخه اول را در اینجا می‌توانید مشاهده کنید.


https://github.com/fandoghpaas/fandogh-examples/tree/master/zero-downtime/v1


::: warning  
توجه داشته باشید که امکان replica تنها برای پلن‌های غیر رایگان فندق قابل استفاده است. اگر کاربر پلن رایگان فندق هستید ‌شما همچنان قادر به استقرار بدون down time ولی با یک replica هستید.
:::


پس از اینکه image پروژه را بر روی فندق منتشر نمودید با استفاده از این مانیفست می‌توانید سرویس نسخه اول را مستقر نمایید.

‍
```yaml
kind: ExternalService
name: zero-downtime
spec:
  image: zero-downtime:v1.0
  port: 8080
  replicas: 2
  readiness_probe:
    http_get:
      path: /
      port: 8080
    initial_delay_seconds: 10
    period_seconds: 5

```


شما می‌توانید این فایل را از اینجا دانلود نمایید.

https://github.com/fandoghpaas/fandogh-examples/blob/master/zero-downtime/service-manifest.yml

اگر با مانیفست‌ها در فندق آشنایی ندارید می‌توانید جزییات و نحوه استفاده از آنها در فندق را در اینجا مطالعه کنید.
https://docs.fandogh.cloud/docs/service-manifest.html

پس از ایجاد فایل مانیفست با استفاده از دستور زیر می‌توانید سرویس را بر روی فندق مستقر نمایید.

fandogh service apply -f service-manifest.yml

خروجی این دستور URL  هایی خواهد بود که وب سایت شما از طریق آنها قابل دسترسی است.

تا به اینجای کار شمای کلی سرویس شما بر روی فندق به شکل زیر خواهد بود. البته توجه داشته باشید که بخش زیاد از جزییات که مرتبط با موضوع این پست نبوده‌اند از این شما حذف شده‌اند. 


![Zero Downtime Deployment step 1](/articles/zero-downtime1.png "Zero Downtime Deployment step 1")  

